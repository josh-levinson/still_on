<div class="event-show">
  <div class="breadcrumb">
    <%= link_to "Groups", groups_path %> &gt; <%= link_to @group.name, group_path(@group.slug) %> &gt; <%= @event.title %>
  </div>

  <div class="event-header">
    <h1><%= @event.title %></h1>
    <% if @event.description.present? %>
      <p class="event-description"><%= @event.description %></p>
    <% end %>
    <div class="event-meta">
      <% if @event.recurrence_type != "none" %>
        <span class="badge badge-recurring"><%= @event.recurrence_type.titleize %> Event</span>
      <% end %>
      <% if @event.location.present? %>
        <span><strong>Default Location:</strong> <%= @event.location %></span>
      <% end %>
      <% if @event.default_duration_minutes.present? %>
        <span><strong>Duration:</strong> <%= @event.default_duration_minutes %> minutes</span>
      <% end %>
    </div>
    <div class="event-actions">
      <% if @event.created_by == current_user || @group.created_by == current_user %>
        <%= link_to "Edit Event", edit_group_event_path(@group.slug, @event), class: "btn btn-secondary" %>
        <%= link_to "Create Occurrence", new_group_event_event_occurrence_path(@group.slug, @event), class: "btn btn-primary" %>
        <%= button_to "Delete Event", group_event_path(@group.slug, @event), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger" %>
      <% end %>
    </div>
  </div>

  <div class="occurrences-section">
    <h2>Upcoming Occurrences</h2>
    <% if @upcoming_occurrences.any? %>
      <div class="occurrences-list">
        <% @upcoming_occurrences.each do |occurrence| %>
          <div class="occurrence-card">
            <%= link_to group_event_event_occurrence_path(@group.slug, @event, occurrence) do %>
              <div class="occurrence-time">
                <span class="date"><%= occurrence.start_time.strftime("%B %d, %Y") %></span>
                <span class="time"><%= occurrence.start_time.strftime("%l:%M %p") %> - <%= occurrence.end_time.strftime("%l:%M %p") %></span>
              </div>
              <% if occurrence.location.present? && occurrence.location != @event.location %>
                <div class="occurrence-location"><%= occurrence.location %></div>
              <% end %>
              <div class="occurrence-meta">
                <span><%= pluralize(occurrence.rsvps.where(status: 'attending').count, 'attendee') %></span>
                <% if occurrence.max_attendees.present? %>
                  <span>Max: <%= occurrence.max_attendees %></span>
                <% end %>
                <span class="badge badge-<%= occurrence.status %>"><%= occurrence.status.titleize %></span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="empty-state">No upcoming occurrences scheduled.</p>
    <% end %>
  </div>

  <% if @past_occurrences.any? %>
    <div class="occurrences-section">
      <h2>Past Occurrences</h2>
      <div class="occurrences-list">
        <% @past_occurrences.each do |occurrence| %>
          <div class="occurrence-card past">
            <%= link_to group_event_event_occurrence_path(@group.slug, @event, occurrence) do %>
              <div class="occurrence-time">
                <span class="date"><%= occurrence.start_time.strftime("%B %d, %Y") %></span>
                <span class="time"><%= occurrence.start_time.strftime("%l:%M %p") %></span>
              </div>
              <div class="occurrence-meta">
                <span><%= pluralize(occurrence.rsvps.where(status: 'attending').count, 'attendee') %></span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
